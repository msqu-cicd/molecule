_include: https://gitea.msqu.de/devops/build_scripts/raw/branch/main/drone/ContainerImageDocker.yml


kind: pipeline
name: default

steps:
  - <<: *ContainerImageDocker
    name: ansible
    depends_on: [ clone ]
    environment:
      DOCKER_ARGS: "--build-arg FROM=python:3-alpine"
      DOCKERFILE: ./Ansible
      TAG_EXPLICIT: "ansible"
      TAG_REF_NORMALIZED_ENABLE: "false"
      ADDITIONAL_REGISTRIES: "schmitzis/builder:"
      REGISTRY_AUTH_JSON:
        from_secret: DOCKER_HUB_AUTH_SCHMITZIS

  - <<: *ContainerImageDocker
    name: ansible-dind
    depends_on: [ clone ]
    environment:
      DOCKER_ARGS: "--build-arg FROM=docker:dind"
      DOCKERFILE: ./DinD
      TAG_EXPLICIT: "ansible-dind"
      TAG_REF_NORMALIZED_ENABLE: "false"
      ADDITIONAL_REGISTRIES: "schmitzis/molecule:"
      REGISTRY_AUTH_JSON:
        from_secret: DOCKER_HUB_AUTH_SCHMITZIS

  - <<: *ContainerImageDocker
    name: archlinux
    depends_on: [ clone ]
    environment:
      DOCKERFILE: ./Archlinux
      TAG_EXPLICIT: "archlinux"
      TAG_REF_NORMALIZED_ENABLE: "false"
      ADDITIONAL_REGISTRIES: "schmitzis/molecule:"
      REGISTRY_AUTH_JSON:
        from_secret: DOCKER_HUB_AUTH_SCHMITZIS

  - <<: *ContainerImageDocker
    name: lint
    depends_on: [ clone ]
    environment:
      DOCKERFILE: ./Lint
      TAG_EXPLICIT: "lint"
      TAG_REF_NORMALIZED_ENABLE: "false"
      ADDITIONAL_REGISTRIES: "schmitzis/molecule:"
      REGISTRY_AUTH_JSON:
        from_secret: DOCKER_HUB_AUTH_SCHMITZIS

  - <<: *ContainerImageDocker
    name: debian-10
    depends_on: [ clone ]
    environment:
      DOCKER_ARGS: "--build-arg OS_VERSION=buster"
      DOCKERFILE: ./Debian
      ADDITIONAL_REGISTRIES: "schmitzis/molecule:"
      REGISTRY_AUTH_JSON:
        from_secret: DOCKER_HUB_AUTH_SCHMITZIS
      TAG_EXPLICIT: "debian-10"
      TAG_REF_NORMALIZED_ENABLE: "false"

  - <<: *ContainerImageDocker
    name: debian-11
    depends_on: [ clone ]
    environment:
      DOCKERFILE: ./Debian
      DOCKER_ARGS: "--build-arg OS_VERSION=bullseye"
      TAG_EXPLICIT: "debian-11"
      TAG_REF_NORMALIZED_ENABLE: "false"
      ADDITIONAL_REGISTRIES: "schmitzis/molecule:"
      REGISTRY_AUTH_JSON:
        from_secret: DOCKER_HUB_AUTH_SCHMITZIS

  - <<: *ContainerImageDocker
    name: debian-12
    depends_on: [ clone ]
    environment:
      DOCKER_ARGS: "--build-arg OS_VERSION=bookworm"
      DOCKERFILE: ./Debian
      TAG_EXPLICIT: "debian-12"
      TAG_REF_NORMALIZED_ENABLE: "false"
      ADDITIONAL_REGISTRIES: "schmitzis/molecule:"
      REGISTRY_AUTH_JSON:
        from_secret: DOCKER_HUB_AUTH_SCHMITZIS

  - <<: *ContainerImageDocker
    name: ubuntu-20.04
    depends_on: [ clone ]
    environment:
      DOCKER_ARGS: "--build-arg OS_VERSION=20.04"
      DOCKERFILE: ./Ubuntu
      TAG_EXPLICIT: "ubuntu-20.04"
      TAG_REF_NORMALIZED_ENABLE: "false"
      ADDITIONAL_REGISTRIES: "schmitzis/molecule:"
      REGISTRY_AUTH_JSON:
        from_secret: DOCKER_HUB_AUTH_SCHMITZIS

  - <<: *ContainerImageDocker
    name: ubuntu-22.04
    depends_on: [ clone ]
    environment:
      DOCKER_ARGS: "--build-arg OS_VERSION=22.04"
      DOCKERFILE: ./Ubuntu
      TAG_EXPLICIT: "ubuntu-22.04"
      TAG_REF_NORMALIZED_ENABLE: "false"
      ADDITIONAL_REGISTRIES: "schmitzis/molecule:"
      REGISTRY_AUTH_JSON:
        from_secret: DOCKER_HUB_AUTH_SCHMITZIS

services:
  - <<: *ContainerImageDockerDinDService
    name: svc_docker_dind

volumes:
  - <<: *ContainerImageDockerVolume
