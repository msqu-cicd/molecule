FROM alpine:3.13

# Configure the container environment
RUN apk add --no-cache bash curl git make shadow \
    && apk add --no-cache python3 py3-pip \
    && apk add --no-cache ansible-base

# Install ansible-lint
RUN pip3 install ansible-lint==5.0.2 \
    && pip3 cache purge

# Configure a non-root user
ARG USER_UID=1000
ARG USER_GID=1000

RUN groupadd -g ${USER_GID} user \
    && useradd -m -s /bin/bash -u ${USER_UID} -g ${USER_GID} user \
    && chown -R user:user /home/user

USER user
ENV USER user
ENV HOME /home/user

# Sanity check
RUN ansible-lint --version

ENTRYPOINT [ "ansible-lint" ]
