FROM docker:dind

RUN apk update && \
    apk add --no-cache \
    python3 py3-botocore python3-dev py3-pip gcc git curl build-base bash \
    autoconf automake py3-cryptography linux-headers \
    musl-dev libffi-dev openssl-dev openssh-client-common sudo sshpass && \
    pip3 --no-cache-dir install ansible jmespath molecule[docker] git+https://github.com/ansible-community/molecule-digitalocean.git git+https://github.com/ansible-community/molecule-ec2.git molecule-hetznercloud netaddr && \
    apk del build-base gcc linux-headers python3-dev perl && \
    mkdir -p ~/.ansible/plugins/modules && \
    curl -o ~/.ansible/plugins/modules/aur.py https://raw.githubusercontent.com/kewlfft/ansible-aur/master/plugins/modules/aur.py

COPY .ansible.cfg /root/.ansible.cfg
